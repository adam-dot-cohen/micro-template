#!/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# move each file to the processed folder after we're done with it
if [ -d /srv/sftp/mgmt/deletepartnersftp ]; then
	for f in /srv/sftp/mgmt/deletepartnersftp/*.cmdtxt; do
        [ -f "$f" ] || break #bash will try to access a non-existent file
        echo "processing $f ..."
        while IFS= read -r user || [[ -n "$user" ]]; do
            delete-sftp-user "$user"
        done < $f
        mv $f /srv/sftp/mgmt/deletepartnersftp/processed
    done
    unset f
fi